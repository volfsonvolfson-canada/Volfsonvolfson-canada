<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="light dark">
  <title>Ground floor — Queen bed | Back to Base</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script>
    // UNIVERSAL THEME INITIALIZATION - Works on ALL pages
    // This script runs synchronously in <head> before page render
    // User can land on ANY page first time - theme defaults to 'dark'
    (function() {
      'use strict';
      try {
        // Get saved theme and user preference flag
        const savedTheme = localStorage.getItem('btb_theme');
        const userSetTheme = localStorage.getItem('btb_theme_user') === '1';
        
        // Determine initial theme:
        // - If user explicitly set theme (userSetTheme=true) AND savedTheme is valid, use savedTheme
        // - Otherwise default to 'dark' (first-time visitor on any page)
        let initialTheme = 'dark';
        
        if (userSetTheme && savedTheme && (savedTheme === 'dark' || savedTheme === 'light' || savedTheme === 'twilight')) {
          initialTheme = savedTheme; // User has chosen theme - use it
        }
        // Else: first-time visitor or invalid theme - use default 'dark'
        
        // Set theme immediately before page renders
        document.documentElement.setAttribute('data-theme', initialTheme);
      } catch (error) {
        // If localStorage fails, default to dark
        document.documentElement.setAttribute('data-theme', 'dark');
      }
    })();
  </script>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="logo" href="index.html">
        <img alt="Back to Base" class="logo-img" />
        <span class="logo-text">Back to Base</span>
      </a>
      <nav class="nav">
        <a href="index.html#rooms">Rooms</a>
        <a href="massage.html">Massage</a>
        <a href="retreat-and-workshop.html">Retreats and Workshops</a>
        <a href="special.php">Special</a>
        <a href="about.php">About us</a>
      </nav>
      <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Toggle mobile menu">
        ☰
      </button>
      <div class="header-actions">
        <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
          <svg class="theme-toggle-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 3v1m0 16v1m9-9h1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span id="theme-text">Light</span>
        </button>
        <a href="login.html" class="btn-signin" id="header-signin">Sign In</a>
      </div>
    </div>
  </header>

  <!-- Mobile Navigation Overlay -->
  <div class="mobile-nav-overlay" id="mobile-nav-overlay"></div>
  
  <!-- Mobile Navigation Menu -->
  <nav class="mobile-nav" id="mobile-nav">
    <a href="index.html#rooms">Rooms</a>
    <a href="massage.html">Massage</a>
    <a href="retreat-and-workshop.html">Retreats and Workshops</a>
    <a href="special.php">Special</a>
    <a href="about.php">About us</a>
    <a href="login.html" class="mobile-nav-signin" id="mobile-nav-signin">Sign In</a>
    <button class="theme-toggle" id="mobile-theme-toggle" aria-label="Toggle theme">
      <svg class="theme-toggle-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 3v1m0 16v1m9-9h1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span id="mobile-theme-text">Light</span>
    </button>
  </nav>

  <div class="page-header">
    <div class="container">
      <h1 id="room-ground-queen-title">Ground floor — Queen bed</h1>
      <p class="section-lead" id="room-ground-queen-subtitle">Bright room near the living room with fireplace. Ideal for two.</p>
    </div>
  </div>

  <section class="hero-contained" aria-label="Room banner">
    <div class="container">
      <img id="room-ground-queen-banner" class="hero-contained-img basement-banner-cropped" data-src-base="assets/forest-fox" alt="Fox in forest" />
    </div>
  </section>

  <main class="section">
    <div class="container room-hero">
      <section>
        <div class="gallery" id="room-ground-queen-gallery">
          <!-- Gallery images will be dynamically inserted here -->
        </div>
      </section>
      <aside class="card">
        <h2>Book this room</h2>
        <p id="room-ground-queen-price"><strong>Price:</strong> 130 CAD / night</p>
        <p id="room-ground-queen-capacity"><strong>Capacity:</strong> up to 2 guests</p>
        <p id="room-ground-queen-description" style="margin-top: 32px;">A small but bright room with a large double bed. A shared bathroom with a spacious bathtub is located nearby.</p>
        <p>The location of the room makes it a perfect spot for socializing and relaxing in the house's common areas. With convenient access to the living room with a fireplace, guests can unwind by the fire and connect with others.</p>
        <p id="room-ground-queen-note" style="margin-top: 16px;">*All tenants may use the sauna and home theatre free of charge, as long as it does not disturb other guests.</p>
        <form class="booking-form" data-room="Ground floor — Queen bed" data-custom-handler novalidate style="margin-top: 40px;">
          <div class="form-row">
            <div>
              <label for="checkin">Check‑in</label>
              <input id="checkin" name="checkin" type="date" required />
            </div>
            <div>
              <label for="checkout">Check‑out</label>
              <input id="checkout" name="checkout" type="date" required />
            </div>
          </div>
          <div class="form-row">
            <div>
              <label for="name">Name</label>
              <input id="name" name="name" type="text" placeholder="Full name" required />
            </div>
            <div>
            </div>
          </div>
          <div class="form-row">
            <div>
              <label for="phone">Phone</label>
              <input id="phone" name="phone" type="tel" placeholder="+1 555 123‑4567" required />
            </div>
            <div>
              <label for="email">Email</label>
              <input id="email" name="email" type="email" placeholder="you@example.com" required />
            </div>
          </div>
          <div class="form-row">
            <div>
              <label for="guests">Guests</label>
              <select id="guests" name="guests" required>
                <option value="" disabled selected hidden>—</option>
                <option value="1">1</option>
                <option value="2">2</option>
              </select>
            </div>
            <div>
              <label for="pets">Pets</label>
              <select id="pets" name="pets" required>
                <option value="" disabled selected hidden>—</option>
                <option value="add">Add pets</option>
                <option value="no">No pets</option>
              </select>
            </div>
          </div>
          <button class="btn primary" type="submit">Book now</button>
          <p class="notice" style="margin-bottom: 0;">Prices are approximate. Confirmation will be sent by email.</p>
          <p class="notice" style="margin-top: 0;"><a href="#" id="checkin-conditions-link" style="color: var(--brand); text-decoration: underline; cursor: pointer;">Check-in conditions</a></p>
        </form>
      </aside>
    </div>
  </main>

  <section id="wellness-section" class="section alt" style="display:none;">
    <div class="container">
      <h2 id="wellness-title">Wellness Experiences</h2>
      <p class="section-lead" id="wellness-description">Enhance your stay with our additional wellness services.<br>Enjoy yoga sessions in the forest, relaxing or deep tissue massages, and the warmth of our private sauna — all designed to make your vacation even more restorative.</p>

      <section class="card card-massage">
        <div class="card-img">
          <img id="wellness-massage-img" class="floor-photo media-43" src="assets/massage.jpg" alt="Massage at Back to Base" />
        </div>
        <div class="card-body">
          <h2 id="wellness-massage-title">Massage</h2>
          <p id="wellness-massage-description">Our guesthouse has a massage room with an experienced therapist who will be happy to make your stay even more enjoyable. Whether you prefer a relaxing massage or a therapeutic deep tissue session — the choice is yours.</p>
          <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <a class="btn primary" href="massage.html">Book massage</a>
          </div>
        </div>
      </section>

      <section class="card card-massage card-massage--alt">
        <div class="card-img">
          <img id="wellness-yoga-img" class="floor-photo media-43" src="assets/yoga.jpg" alt="Yoga at Back to Base" />
        </div>
        <div class="card-body">
          <h2 id="wellness-yoga-title">Yoga</h2>
          <p id="wellness-yoga-description">On the property, surrounded by a cozy forest, you'll find platforms for yoga and meditation. An experienced instructor will guide you towards harmony with yourself and the world, while the soothing sound of a mountain stream nearby will be your soundtrack along the way.</p>
          <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <a class="btn primary" href="retreat-and-workshop.html">Book retreat</a>
          </div>
        </div>
      </section>

      <section class="card card-massage">
        <div class="card-img">
          <img id="wellness-sauna-img" class="floor-photo media-43" src="assets/plan-basement-bedroom.jpg" alt="Sauna at Back to Base" />
        </div>
        <div class="card-body">
          <h2 id="wellness-sauna-title">Sauna</h2>
          <p id="wellness-sauna-description">After a day spent in nature, sometimes you just want to warm up. We understand how important comfort is, so we offer our guests free access to a small sauna. It is located right in the house, on the basement floor.</p>
          <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <a class="btn primary" href="massage.html">Book sauna session</a>
          </div>
        </div>
      </section>
    </div>
  </section>

  <footer class="site-footer">
    <div class="container footer-grid">
      <div>
        <h4>Contact</h4>
        <p id="footer-contact-address">British Columbia, Canada</p>
        <p id="footer-contact-phone">Phone: +1 (555) 123‑4567</p>
        <p id="footer-contact-email">Email: hello@backtobase.example</p>
      </div>
      <div>
        <h4>Navigation</h4>
        <ul class="footer-nav">
          <li><a href="index.html#rooms">Rooms</a></li>
          <li><a href="massage.html">Massage</a></li>
          <li><a href="retreat-and-workshop.html">Retreats and Workshops</a></li>
          <li><a href="special.php">Special</a></li>
          <li><a href="about.php">About us</a></li>
        </ul>
      </div>
      <div>
        <h4>Quiet hours</h4>
        <p>22:00 — 07:00</p>
      </div>
    </div>
    <div class="container copyright">© <span id="year"></span> Back to Base</div>
  </footer>

  <!-- Check-in Conditions Modal -->
  <div id="checkin-conditions-modal" class="checkin-modal">
    <div class="checkin-modal-overlay"></div>
    <div class="checkin-modal-content">
      <button class="checkin-modal-close" id="checkin-close">&times;</button>
      <h3>Check-in conditions</h3>
      <p>Check-in from 3:00 PM, Check-out until 11:00 AM.</p>
      <p>Detailed information on how to find our house and what is located nearby can be found on the About Us page</p>
    </div>
  </div>

  <!-- Gallery Modal -->
  <div id="gallery-modal" class="gallery-modal">
    <div class="gallery-modal-content">
      <button class="gallery-modal-close" id="gallery-close">&times;</button>
      <img id="gallery-modal-image" class="gallery-modal-image" src="" alt="">
      <button class="gallery-modal-nav gallery-modal-prev" id="gallery-prev">‹</button>
      <button class="gallery-modal-nav gallery-modal-next" id="gallery-next">›</button>
      <div class="gallery-modal-counter" id="gallery-counter"></div>
    </div>
  </div>

  <script src="utils.js?v=26"></script>
  <script src="script.js?v=26"></script>
  <script>
    // Check-in conditions modal
    (function() {
      const modal = document.getElementById('checkin-conditions-modal');
      const link = document.getElementById('checkin-conditions-link');
      const closeBtn = document.getElementById('checkin-close');
      const overlay = modal.querySelector('.checkin-modal-overlay');
      
      if (!modal || !link) return;
      
      // Open modal
      link.addEventListener('click', (e) => {
        e.preventDefault();
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
      });
      
      // Close modal
      function closeModal() {
        modal.classList.remove('active');
        document.body.style.overflow = '';
      }
      
      closeBtn.addEventListener('click', closeModal);
      overlay.addEventListener('click', closeModal);
      
      // Close on Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modal.classList.contains('active')) {
          closeModal();
        }
      });
    })();
  </script>
  <script src="auth.js?v=26"></script>
  <script>
    // Load room ground queen content from API
    async function loadRoomGroundQueenContentFromAPI() {
      try {
        const formData = new FormData();
        formData.append('action', 'get_content');
        
        const response = await fetch('api.php', {
          method: 'POST',
          body: formData
        });
        
        if (response.ok) {
          const result = await response.json();
          if (result.success && result.data) {
            const data = result.data;
            
            // Update text content
            const title = document.getElementById('room-ground-queen-title');
            const subtitle = document.getElementById('room-ground-queen-subtitle');
            const price = document.getElementById('room-ground-queen-price');
            const capacity = document.getElementById('room-ground-queen-capacity');
            const description = document.getElementById('room-ground-queen-description');
            const note = document.getElementById('room-ground-queen-note');
            
            if (title && data.roomGroundQueenTitle) title.textContent = data.roomGroundQueenTitle;
            if (subtitle && data.roomGroundQueenSubtitle) subtitle.textContent = data.roomGroundQueenSubtitle;
            if (price && data.roomGroundQueenPrice) price.innerHTML = data.roomGroundQueenPrice;
            if (capacity && data.roomGroundQueenCapacity) capacity.innerHTML = data.roomGroundQueenCapacity;
            if (description && data.roomGroundQueenDescription) description.textContent = data.roomGroundQueenDescription;
            if (note && data.roomGroundQueenNote) note.textContent = data.roomGroundQueenNote;
            
            // Update banner image
            const banner = document.getElementById('room-ground-queen-banner');
            if (banner) {
              if (data.roomGroundQueenBannerImageUrl) {
                console.log('Updating banner image:', data.roomGroundQueenBannerImageUrl);
                banner.src = data.roomGroundQueenBannerImageUrl + '?v=' + Date.now();
                banner.removeAttribute('data-src-base');
                // Force image reload
                banner.onload = () => {
                  console.log('Banner image loaded successfully');
                };
                banner.onerror = () => {
                  console.error('Failed to load banner image:', data.roomGroundQueenBannerImageUrl);
                };
              } else {
                console.log('No banner URL in API response');
              }
            } else {
              console.error('Banner element not found');
            }
            
            // Update gallery
            let gallery = [];
            try {
              gallery = JSON.parse(data.roomGroundQueenGallery || '[]');
            } catch (e) {
              console.error('Failed to parse gallery:', e);
            }
            
            if (gallery.length > 0) {
              updateGallery(gallery);
            }
          }
        }
      } catch (error) {
        console.log('Failed to load room ground queen content from API:', error);
      }
    }
    
    // Gallery functionality for Ground floor — Queen bed
    let galleryImages = [];
    let currentImageIndex = 0;
    
    function updateGallery(gallery) {
      galleryImages = gallery;
      const galleryContainer = document.getElementById('room-ground-queen-gallery');
      if (!galleryContainer) return;
      
      galleryContainer.innerHTML = '';
      gallery.forEach((imageUrl, index) => {
        const img = document.createElement('img');
        img.src = imageUrl + '?v=' + Date.now();
        img.alt = `Ground floor Queen bed ${index + 1}`;
        img.style.cursor = 'pointer';
        img.onclick = () => openGalleryModal(index);
        galleryContainer.appendChild(img);
      });
      
      // Reinitialize gallery click handlers
      document.querySelectorAll('#room-ground-queen-gallery img').forEach((img, index) => {
        img.addEventListener('click', () => {
          openGalleryModal(index);
        });
      });
    }
    
    function openGalleryModal(index) {
      if (galleryImages.length === 0) return;
      currentImageIndex = index;
      updateGalleryModal();
      const modal = document.getElementById('gallery-modal');
      if (modal) {
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
      }
    }
    
    function closeGalleryModal() {
      const modal = document.getElementById('gallery-modal');
      if (modal) {
        modal.classList.remove('active');
        document.body.style.overflow = '';
      }
    }
    
    function showPreviousImage() {
      if (galleryImages.length === 0) return;
      currentImageIndex = (currentImageIndex - 1 + galleryImages.length) % galleryImages.length;
      updateGalleryModal();
    }
    
    function showNextImage() {
      if (galleryImages.length === 0) return;
      currentImageIndex = (currentImageIndex + 1) % galleryImages.length;
      updateGalleryModal();
    }
    
    function updateGalleryModal() {
      const modalImage = document.getElementById('gallery-modal-image');
      const counter = document.getElementById('gallery-counter');
      
      if (!modalImage || galleryImages.length === 0) return;
      
      // Добавляем плавный переход
      modalImage.style.opacity = '0';
      
      setTimeout(() => {
        modalImage.src = galleryImages[currentImageIndex] + '?v=' + Date.now();
        modalImage.alt = `Image ${currentImageIndex + 1} of ${galleryImages.length}`;
        if (counter) counter.textContent = `${currentImageIndex + 1} / ${galleryImages.length}`;
        
        // Показываем изображение с плавным появлением
        modalImage.style.opacity = '1';
      }, 150);
    }
    
    // Initialize gallery handlers
    document.addEventListener('DOMContentLoaded', () => {
      const galleryClose = document.getElementById('gallery-close');
      const galleryModal = document.getElementById('gallery-modal');
      const galleryPrev = document.getElementById('gallery-prev');
      const galleryNext = document.getElementById('gallery-next');
      
      if (galleryClose) {
        galleryClose.addEventListener('click', closeGalleryModal);
      }
      
      if (galleryModal) {
        galleryModal.addEventListener('click', (e) => {
          if (e.target.id === 'gallery-modal') {
            closeGalleryModal();
          }
        });
      }
      
      if (galleryPrev) {
        galleryPrev.addEventListener('click', showPreviousImage);
      }
      
      if (galleryNext) {
        galleryNext.addEventListener('click', showNextImage);
      }
      
      // Keyboard navigation
      document.addEventListener('keydown', (e) => {
        if (galleryModal && galleryModal.classList.contains('active')) {
          if (e.key === 'Escape') closeGalleryModal();
          if (e.key === 'ArrowLeft') showPreviousImage();
          if (e.key === 'ArrowRight') showNextImage();
        }
      });
      
      // Load content from API
      loadRoomGroundQueenContentFromAPI();
    });
  </script>
  <!-- Flatpickr для визуальной блокировки занятых дат в календаре -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.js"></script>
  <script src="auth-menu.js"></script>
  <script src="booking.js"></script>
  <script>
    // Load wellness experiences content from API
    async function loadWellnessContentFromAPI() {
      try {
        const formData = new FormData();
        formData.append('action', 'get_content');
        
        const response = await fetch('api.php', {
          method: 'POST',
          body: formData
        });
        
        if (response.ok) {
          const result = await response.json();
          if (result.success && result.data) {
            const data = result.data;
            
            // Update section header
            const title = document.getElementById('wellness-title');
            const description = document.getElementById('wellness-description');
            if (title && data.wellnessTitle) title.textContent = data.wellnessTitle;
            if (description && data.wellnessDescription) description.innerHTML = data.wellnessDescription.replace(/\n/g, '<br>');
            
            // Update massage card
            const massageTitle = document.getElementById('wellness-massage-title');
            const massageDesc = document.getElementById('wellness-massage-description');
            const massageImg = document.getElementById('wellness-massage-img');
            if (massageTitle && data.wellnessMassageTitle) massageTitle.textContent = data.wellnessMassageTitle;
            if (massageDesc && data.wellnessMassageDescription) massageDesc.textContent = data.wellnessMassageDescription;
            if (massageImg && data.wellnessMassageImageUrl) {
              massageImg.src = data.wellnessMassageImageUrl + '?v=' + Date.now();
              massageImg.srcset = data.wellnessMassageImageUrl + '?v=' + Date.now();
            }
            
            // Update yoga card
            const yogaTitle = document.getElementById('wellness-yoga-title');
            const yogaDesc = document.getElementById('wellness-yoga-description');
            const yogaImg = document.getElementById('wellness-yoga-img');
            if (yogaTitle && data.wellnessYogaTitle) yogaTitle.textContent = data.wellnessYogaTitle;
            if (yogaDesc && data.wellnessYogaDescription) yogaDesc.textContent = data.wellnessYogaDescription;
            if (yogaImg && data.wellnessYogaImageUrl) {
              yogaImg.src = data.wellnessYogaImageUrl + '?v=' + Date.now();
              yogaImg.srcset = data.wellnessYogaImageUrl + '?v=' + Date.now();
            }
            
            // Update sauna card
            const saunaTitle = document.getElementById('wellness-sauna-title');
            const saunaDesc = document.getElementById('wellness-sauna-description');
            const saunaImg = document.getElementById('wellness-sauna-img');
            if (saunaTitle && data.wellnessSaunaTitle) saunaTitle.textContent = data.wellnessSaunaTitle;
            if (saunaDesc && data.wellnessSaunaDescription) saunaDesc.textContent = data.wellnessSaunaDescription;
            if (saunaImg && data.wellnessSaunaImageUrl) {
              saunaImg.src = data.wellnessSaunaImageUrl + '?v=' + Date.now();
              saunaImg.srcset = data.wellnessSaunaImageUrl + '?v=' + Date.now();
            }
          }
        }
      } catch (error) {
        console.log('Failed to load wellness content from API:', error);
      }
    }
    
    // Load wellness content on page load
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadWellnessContentFromAPI);
    } else {
      loadWellnessContentFromAPI();
    }
  </script>
</body>
</html>
