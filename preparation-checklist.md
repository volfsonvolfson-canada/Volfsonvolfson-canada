# Чеклист подготовки к реализации системы бронирования

## Что нужно подготовить перед началом работы

### 1. API ключи и аккаунты

#### 1.1 SendGrid (Email-сервис)
- [ ] **Создать аккаунт**: Зарегистрироваться на https://sendgrid.com (есть бесплатный тариф 100 писем/день)
- [ ] **Верифицировать отправителя**: Настроить верификацию email адреса или домена
- [ ] **Получить API ключ**:
  - Войдите в SendGrid Dashboard
  - Settings → API Keys
  - Create API Key
  - Выберите "Full Access" или создайте ключ с правами на отправку писем
  - Скопируйте API ключ (он показывается только один раз!)
- [ ] **Подготовить email адрес отправителя**: Например, `bookings@backtobase.ca` или `noreply@backtobase.ca`
- [ ] **Подготовить email хозяина гостиницы**: Куда будут приходить уведомления о новых бронированиях

**Где сохранить**: API ключ будет добавлен в `config.php` как `SENDGRID_API_KEY`

#### 1.2 Stripe (Платежная система)
- [ ] **Создать аккаунт**: Зарегистрироваться на https://stripe.com/ca
- [ ] **Заполнить бизнес-информацию**: Для работы с реальными платежами нужна верификация бизнеса
- [ ] **Получить API ключи**:
  - Dashboard → Developers → API keys
  - **Publishable key** (публичный ключ) - можно использовать на фронтенде
  - **Secret key** (секретный ключ) - только для бэкенда
  - Начать с **Test mode** для тестирования
- [ ] **Настроить Webhook**:
  - Developers → Webhooks
  - Add endpoint: `https://new.backtobase.ca/stripe_webhook.php`
  - Выбрать события: `payment_intent.succeeded`, `payment_intent.payment_failed`
  - Получить **Webhook signing secret**
- [ ] **Настроить валюту**: CAD (канадский доллар) должен быть по умолчанию
- [ ] **Для продакшена**: Активировать Live mode после тестирования

**Где сохранить**:
- `STRIPE_PUBLISHABLE_KEY` в `config.php` (публичный ключ)
- `STRIPE_SECRET_KEY` в `config.php` (секретный ключ)
- `STRIPE_WEBHOOK_SECRET` в `config.php` (секрет для webhook)

### 2. Airbnb календарь

#### 2.1 iCal URL для каждой комнаты
- [ ] **Для каждой комнаты получить iCal ссылку**:
  - Войдите в Airbnb аккаунт
  - Перейдите в Listings → выберите ваше объявление
  - Calendar → Sync calendars
  - Скопируйте **Export calendar** ссылку (iCal URL)
  - Пример: `https://www.airbnb.com/calendar/ical/123456.ics?key=abc123...`
- [ ] **Составить список**:
  ```
  Basement: https://www.airbnb.com/calendar/ical/...
  Ground Floor - Queen bed: https://www.airbnb.com/calendar/ical/...
  Ground Floor - Twin bed: https://www.airbnb.com/calendar/ical/...
  Loft: https://www.airbnb.com/calendar/ical/...
  ```
- [ ] **Проверить доступность URL**: Открыть ссылку в браузере, должен загрузиться файл .ics

**Где сохранить**: iCal URL будут храниться в базе данных или конфигурации для каждой комнаты

### 3. База данных

#### 3.1 Доступ к базе данных
- [ ] **Проверить доступ**: Убедиться, что у вас есть доступ к phpMyAdmin или другой инструмент для работы с БД
- [ ] **Проверить права**: Учетная запись БД должна иметь права на создание таблиц
- [ ] **Создать резервную копию**: Перед созданием новых таблиц сделать backup текущей БД

#### 3.2 Информация о комнатах
- [ ] **Подготовить список всех комнат** с точными названиями:
  - Названия должны совпадать с теми, что используются на сайте
  - Пример: "Basement - Queen bed", "Ground Floor - Queen bed", "Ground Floor - Twin bed", "Loft"
- [ ] **Цены для каждой комнаты**: Убедиться, что цены актуальны (для расчета стоимости бронирования)

### 4. Хостинг и сервер

#### 4.1 Доступ к файлам
- [ ] **Проверить доступ через FTP/SFTP или файловый менеджер** хостинга
- [ ] **Создать папку для шаблонов**: `templates/` для email-шаблонов

#### 4.2 PHP зависимости (Composer)
- [ ] **Проверить, установлен ли Composer** на хостинге:
  - Обычно доступен через SSH или панель управления хостингом
  - Если нет - уточнить у хостинг-провайдера
- [ ] **Подготовить `composer.json`** для установки пакетов:
  ```json
  {
    "require": {
      "sendgrid/sendgrid": "^8.0",
      "stripe/stripe-php": "^10.0",
      "kigkonsult/icalcreator": "^2.40"
    }
  }
  ```

#### 4.3 Cron задачи (для автоматической синхронизации Airbnb)
- [ ] **Проверить доступ к настройке cron** на хостинге
- [ ] **Подготовить команду для cron**:
  ```
  0 * * * * php /path/to/cron_sync_airbnb.php
  ```
  (каждый час синхронизация календаря Airbnb)

#### 4.4 SSL сертификат (обязательно для Stripe)
- [ ] **Проверить, что сайт работает по HTTPS**: `https://new.backtobase.ca`
- [ ] **Stripe требует HTTPS** для обработки платежей

### 5. Настройки сайта

#### 5.1 Email настройки
- [ ] **Отправитель**: Email адрес, с которого будут отправляться письма (например, `bookings@backtobase.ca`)
- [ ] **Получатель (хозяин)**: Email адрес хозяина гостиницы для уведомлений о новых бронированиях
- [ ] **Название компании**: Для подписи в письмах (например, "Back to Base Hotel")

#### 5.2 Тексты и информация
- [ ] **Политика отмены**: Подготовить текст политики отмены бронирований
- [ ] **Правила заселения**: Время check-in и check-out
- [ ] **Условия бронирования**: Текст с условиями и правилами

### 6. Тестовые данные

#### 6.1 Тестовые карты для Stripe
- [ ] **Подготовить тестовые карты** для проверки платежей:
  - Успешная оплата: `4242 4242 4242 4242`
  - Отклоненная карта: `4000 0000 0000 0002`
  - См. https://stripe.com/docs/testing

#### 6.2 Тестовые email адреса
- [ ] **Подготовить тестовые email** для проверки отправки писем

### 7. Опционально: Дополнительные настройки

#### 7.1 Логирование
- [ ] **Создать папку для логов**: `logs/` (если планируется логирование ошибок)

#### 7.2 Безопасность
- [ ] **Настроить .htaccess** для защиты конфиденциальных файлов (если нужно)

---

## Приоритеты подготовки

### Критично (нужно перед началом Фазы 1-2):
1. ✅ Доступ к базе данных
2. ✅ Список комнат с названиями
3. ✅ SendGrid API ключ (для Фазы 2)

### Важно (нужно перед Фазой 3):
4. ✅ Stripe API ключи (Test mode для начала)
5. ✅ Stripe Webhook endpoint URL

### Желательно (можно подготовить параллельно):
6. ✅ Airbnb iCal URL для каждой комнаты
7. ✅ Email адреса (отправитель и получатель)
8. ✅ Cron доступ на хостинге

---

## Рекомендуемый порядок действий

1. **Сначала**: Подготовить SendGrid аккаунт и API ключ (Фаза 2)
2. **Затем**: Подготовить Stripe аккаунт и тестовые ключи (Фаза 3)
3. **Параллельно**: Собрать iCal URL для Airbnb (Фаза 4)
4. **Перед запуском**: Настроить cron задачи и webhook endpoints

---

## Вопросы для уточнения

Если что-то неясно, лучше уточнить заранее:

- [ ] Есть ли у вас доменный email (например, `@backtobase.ca`) или будете использовать обычный?
- [ ] Нужна ли обработка нескольких валют или только CAD?
- [ ] Какая политика отмены бронирований (полный возврат, частичный, невозвратная)?
- [ ] Сколько дней заранее можно бронировать (максимальный период)?
- [ ] Есть ли минимальное количество ночей для бронирования?

