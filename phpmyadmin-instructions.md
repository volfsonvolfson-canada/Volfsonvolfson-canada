# Инструкция по выполнению SQL скрипта в phpMyAdmin

## Способ 1: Импорт через интерфейс phpMyAdmin (Рекомендуется)

### Шаг 1: Откройте phpMyAdmin
1. Войдите в phpMyAdmin на вашем хостинге
2. Убедитесь, что выбрана правильная база данных (обычно `newbackt_bttbs_btb`)

### Шаг 2: Перейдите в раздел "Импорт"
1. В верхнем меню phpMyAdmin найдите вкладку **"Импорт"** (Import)
2. Или нажмите на название вашей базы данных слева, затем выберите **"Импорт"** во вкладках

### Шаг 3: Загрузите SQL файл
1. Нажмите кнопку **"Выбрать файл"** или **"Choose File"**
2. Найдите файл `database_schema.sql` на вашем компьютере
3. Выберите файл и нажмите **"Открыть"**

### Шаг 4: Настройте параметры импорта (опционально)
- Обычно настройки по умолчанию работают корректно
- Если есть проблемы с кодировкой, выберите **"utf8"** или **"utf8mb4"**
- Формат должен быть **"SQL"**

### Шаг 5: Запустите импорт
1. Прокрутите страницу вниз
2. Нажмите кнопку **"Вперед"** или **"Go"** внизу страницы
3. Дождитесь завершения импорта

### Шаг 6: Проверьте результат
После успешного импорта вы должны увидеть сообщение типа:
- ✅ **"Импорт успешно завершен"** или **"Import has been successfully finished"**
- И количество запросов, например: **"52 SQL запросов выполнено"**

### Шаг 7: Проверьте созданные таблицы
1. Слева в списке баз данных выберите вашу базу данных (`newbackt_bttbs_btb`)
2. В списке таблиц вы должны увидеть новые таблицы:
   - ✅ `bookings`
   - ✅ `blocked_dates`
   - ✅ `airbnb_calendar`
   - ✅ `booking_confirmations`
   - ✅ `room_airbnb_settings`

---

## Способ 2: Выполнение SQL через SQL-редактор (Альтернатива)

Если импорт не работает, можно выполнить SQL напрямую:

### Шаг 1: Откройте SQL редактор
1. В phpMyAdmin выберите вашу базу данных
2. Нажмите на вкладку **"SQL"** в верхнем меню

### Шаг 2: Скопируйте содержимое файла
1. Откройте файл `database_schema.sql` на вашем компьютере
2. Скопируйте **ВСЁ** содержимое файла (Ctrl+A, затем Ctrl+C)

### Шаг 3: Вставьте SQL код
1. Вставьте скопированный код в большое текстовое поле SQL редактора
2. Убедитесь, что весь код вставлен

### Шаг 4: Выполните SQL
1. Нажмите кнопку **"Вперед"** или **"Go"**
2. Дождитесь выполнения

### Шаг 5: Проверьте результат
- Должны увидеть сообщения об успешном создании каждой таблицы
- Проверьте список таблиц слева

---

## Способ 3: Выполнение SQL по частям (Если возникли ошибки)

Если при выполнении всего скрипта возникают ошибки, можно выполнять его по частям:

### Шаг 1: Откройте SQL редактор
1. В phpMyAdmin выберите вашу базу данных
2. Нажмите на вкладку **"SQL"**

### Шаг 2: Выполняйте по одной таблице
Откройте файл `database_schema.sql` и выполните каждый блок `CREATE TABLE` отдельно:

**Таблица 1: bookings**
```sql
CREATE TABLE IF NOT EXISTS `bookings` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `room_name` VARCHAR(255) NOT NULL COMMENT 'Название комнаты',
  `checkin_date` DATE NOT NULL COMMENT 'Дата заезда',
  `checkout_date` DATE NOT NULL COMMENT 'Дата выезда',
  `guest_name` VARCHAR(255) NOT NULL COMMENT 'Имя гостя',
  `email` VARCHAR(255) NOT NULL COMMENT 'Email гостя',
  `phone` VARCHAR(50) NOT NULL COMMENT 'Телефон гостя',
  `guests_count` INT(3) NOT NULL DEFAULT 1 COMMENT 'Количество гостей',
  `pets` TINYINT(1) NOT NULL DEFAULT 0 COMMENT 'Наличие домашних животных',
  `status` ENUM('pending', 'confirmed', 'cancelled') NOT NULL DEFAULT 'pending' COMMENT 'Статус бронирования',
  `payment_status` ENUM('pending', 'paid', 'refunded', 'failed') NOT NULL DEFAULT 'pending' COMMENT 'Статус оплаты',
  `payment_intent_id` VARCHAR(255) NULL COMMENT 'ID платежного намерения Stripe',
  `total_amount` DECIMAL(10, 2) NOT NULL DEFAULT 0.00 COMMENT 'Общая сумма бронирования',
  `currency` VARCHAR(3) NOT NULL DEFAULT 'CAD' COMMENT 'Валюта',
  `stripe_payment_id` VARCHAR(255) NULL COMMENT 'ID платежа в Stripe',
  `airbnb_synced` TINYINT(1) NOT NULL DEFAULT 0 COMMENT 'Синхронизировано с Airbnb',
  `special_requests` TEXT NULL COMMENT 'Особые пожелания гостя',
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'Дата создания',
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'Дата обновления',
  PRIMARY KEY (`id`),
  INDEX `idx_room_name` (`room_name`),
  INDEX `idx_checkin_date` (`checkin_date`),
  INDEX `idx_checkout_date` (`checkout_date`),
  INDEX `idx_status` (`status`),
  INDEX `idx_payment_status` (`payment_status`),
  INDEX `idx_email` (`email`),
  INDEX `idx_dates_range` (`checkin_date`, `checkout_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='Таблица бронирований';
```

После выполнения проверьте, что таблица создана. Затем переходите к следующей таблице.

---

## Проверка успешного выполнения

После выполнения SQL скрипта проверьте:

1. **Список таблиц** (слева в phpMyAdmin):
   - Должны появиться 5 новых таблиц:
     - `bookings`
     - `blocked_dates`
     - `airbnb_calendar`
     - `booking_confirmations`
     - `room_airbnb_settings`

2. **Структура таблиц**:
   - Кликните на любую таблицу (например, `bookings`)
   - Нажмите вкладку **"Структура"** или **"Structure"**
   - Убедитесь, что все поля созданы правильно

3. **Отсутствие ошибок**:
   - Не должно быть красных сообщений об ошибках
   - Если есть ошибки, скопируйте их и сообщите мне

---

## Возможные проблемы и решения

### Проблема 1: "Table already exists" (Таблица уже существует)
**Решение**: Это нормально, если таблицы уже были созданы ранее. Скрипт использует `CREATE TABLE IF NOT EXISTS`, поэтому он пропустит существующие таблицы.

### Проблема 2: "Access denied" (Доступ запрещен)
**Решение**: Убедитесь, что вы подключены к правильной базе данных и у вас есть права на создание таблиц.

### Проблема 3: Ошибки кодировки (кириллица отображается как "????")
**Решение**: В phpMyAdmin при импорте выберите кодировку **"utf8mb4"** или **"utf8"**.

### Проблема 4: Ошибка "Syntax error"
**Решение**: 
- Убедитесь, что скопировали весь SQL код полностью
- Проверьте, что не пропустили точку с запятой `;` в конце каждой команды
- Попробуйте выполнить по частям (Способ 3)

---

## После успешного выполнения

После того, как таблицы созданы:
1. ✅ Сообщите мне, что всё готово
2. ✅ Можно продолжать с Phase 2 (Email-система)
3. ✅ Или можете начать тестировать API бронирований

---

## Скриншоты для наглядности

В phpMyAdmin вы должны увидеть:
- Вкладку **"Импорт"** / **"Import"** в верхнем меню
- Кнопку **"Выбрать файл"** / **"Choose File"**
- После импорта - сообщение об успешном выполнении

Если что-то непонятно или возникают ошибки - напишите мне, и я помогу решить проблему!

