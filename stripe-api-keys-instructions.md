# Инструкция по получению API ключей Stripe

## Шаг 1: Регистрация в Stripe (если еще не зарегистрированы)

1. Перейдите на сайт Stripe: https://stripe.com
2. Нажмите кнопку **"Get started"** или **"Start now"**
3. Зарегистрируйтесь, указав:
   - Email адрес
   - Пароль
   - Название бизнеса (например, "Back to Base Hotel")
   - Страна: **Canada**

## Шаг 2: Вход в Dashboard Stripe

1. После регистрации войдите в свой аккаунт: https://dashboard.stripe.com/login
2. Вы попадете в Dashboard (панель управления) Stripe

## Шаг 3: Переключение в Test Mode (для начала)

**Важно**: Начните с тестового режима (Test Mode) для безопасного тестирования.

1. В верхней части страницы Dashboard найдите переключатель **"Test mode"** / **"Тестовый режим"**
2. Убедитесь, что переключатель **ВКЛЮЧЕН** (обычно показывается фиолетовым/синим цветом)
3. Когда включен Test Mode, в интерфейсе будет показано **"Test mode"** или **"Тестовый режим"**

## Шаг 4: Получение API ключей

### 4.1 Откройте раздел API ключей

1. В левом боковом меню Dashboard найдите раздел **"Developers"** (Разработчики)
2. Нажмите на **"Developers"** чтобы раскрыть подменю
3. Выберите **"API keys"** (API ключи)

Или используйте прямой URL:
- https://dashboard.stripe.com/test/apikeys (для Test mode)
- https://dashboard.stripe.com/apikeys (для Live mode)

### 4.2 Найдите нужные ключи

На странице API keys вы увидите два ключа:

#### 1. Publishable key (Публичный ключ)
- ✅ **Где находится**: В секции **"Standard keys"** или **"Standard"**
- ✅ **Поле**: **"Publishable key"** (Публичный ключ)
- ✅ **Вид**: Начинается с `pk_test_...` (для Test mode) или `pk_live_...` (для Live mode)
- ✅ **Использование**: Этот ключ можно использовать на фронтенде (в JavaScript), он безопасен для публикации

#### 2. Secret key (Секретный ключ)
- ⚠️ **Где находится**: В той же секции **"Standard keys"**
- ⚠️ **Поле**: **"Secret key"** (Секретный ключ)
- ⚠️ **Вид**: Начинается с `sk_test_...` (для Test mode) или `sk_live_...` (для Live mode)
- ⚠️ **Важно**: Этот ключ виден только один раз! Если вы его потеряли, можно создать новый
- ⚠️ **Использование**: Используется только на бэкенде (в PHP), **НИКОГДА** не публикуйте его!

### 4.3 Скопируйте ключи

1. Нажмите на кнопку **"Reveal test key"** / **"Показать тестовый ключ"** рядом с Secret key, чтобы увидеть его
2. Скопируйте оба ключа в безопасное место (например, в текстовый файл)
3. **Не делитесь** Secret key ни с кем!

## Шаг 5: Получение Webhook Signing Secret

Webhook Signing Secret нужен для проверки подлинности запросов от Stripe.

### 5.1 Создайте Webhook Endpoint

1. В левом меню Dashboard перейдите в **"Developers"** → **"Webhooks"**
2. Нажмите кнопку **"Add endpoint"** или **"Добавить endpoint"**
3. В поле **"Endpoint URL"** введите:
   ```
   https://new.backtobase.ca/stripe_webhook.php
   ```
4. В разделе **"Events to send"** (События для отправки) выберите:
   - ✅ `payment_intent.succeeded` (платеж успешен)
   - ✅ `payment_intent.payment_failed` (платеж не удался)
   - ✅ `payment_intent.canceled` (платеж отменен)
5. Нажмите **"Add endpoint"** / **"Добавить endpoint"**

### 5.2 Получите Signing Secret

1. После создания endpoint, нажмите на него в списке
2. Найдите секцию **"Signing secret"** (Секрет подписи)
3. Нажмите на кнопку **"Reveal"** / **"Показать"** чтобы увидеть секрет
4. Скопируйте Signing secret (начинается с `whsec_...`)

**Важно**: Signing secret показывается только один раз. Если потеряете, можно создать новый endpoint.

## Шаг 6: Добавление ключей в config.php

После получения всех ключей, добавьте их в файл `config.php`:

```php
// ==========================================
// Настройки Stripe (Платежная система)
// ==========================================

// Test Mode ключи (для начала)
define('STRIPE_SECRET_KEY', 'sk_test_...'); // ⚠️ Вставьте ваш Secret key
define('STRIPE_PUBLISHABLE_KEY', 'pk_test_...'); // Вставьте ваш Publishable key
define('STRIPE_WEBHOOK_SECRET', 'whsec_...'); // Вставьте ваш Webhook Signing secret
define('STRIPE_CURRENCY', 'cad'); // Валюта: CAD (канадский доллар)
define('STRIPE_TEST_MODE', true); // true для тестирования, false для продакшена
```

**Важно**: 
- Замените `sk_test_...`, `pk_test_...`, `whsec_...` на ваши реальные ключи
- Не добавляйте ключи, пока не создадите Webhook endpoint
- Для начала используйте Test Mode (`STRIPE_TEST_MODE = true`)

## Шаг 7: Переключение в Live Mode (для продакшена)

После тестирования и готовности к реальным платежам:

1. В Dashboard Stripe переключите **Test mode** на **Live mode**
2. Перейдите в **Developers** → **API keys**
3. Скопируйте **Live keys** (начинаются с `pk_live_...` и `sk_live_...`)
4. Обновите `config.php`:
   - Замените ключи на Live ключи
   - Измените `STRIPE_TEST_MODE` на `false`
   - Обновите Webhook endpoint на Live endpoint

## Тестовые карты для проверки

Stripe предоставляет тестовые карты для проверки платежей:

### Успешные платежи:
- **Карта**: `4242 4242 4242 4242`
- **Дата**: Любая будущая дата (например, 12/25)
- **CVC**: Любой 3-значный код (например, 123)
- **ZIP**: Любой 5-значный код (например, 12345)

### Неуспешные платежи:
- **Карта**: `4000 0000 0000 0002` (отклоненная карта)
- **Карта**: `4000 0000 0000 9995` (недостаточно средств)

### 3D Secure (двухфакторная аутентификация):
- **Карта**: `4000 0025 0000 3155`

Подробнее о тестовых картах: https://stripe.com/docs/testing

## Безопасность

⚠️ **ВАЖНЫЕ ПРАВИЛА БЕЗОПАСНОСТИ**:

1. ❌ **НИКОГДА** не публикуйте Secret key в публичных репозиториях (GitHub, GitLab и т.д.)
2. ❌ **НИКОГДА** не используйте Secret key на фронтенде (JavaScript)
3. ✅ Используйте Secret key **ТОЛЬКО** на бэкенде (PHP)
4. ✅ Используйте Publishable key на фронтенде (JavaScript) - он безопасен для публикации
5. ✅ Храните Secret key в `config.php`, который должен быть защищен от публичного доступа
6. ✅ Регулярно проверяйте использование ключей в Dashboard → Developers → API keys

## Проверка ключей

После добавления ключей в `config.php`, можно проверить их работу:

1. Загрузите обновленный `config.php` на хостинг
2. В Stripe Dashboard → Developers → API keys найдите раздел **"Recent API requests"**
3. Попробуйте создать тестовое бронирование с оплатой
4. В Dashboard должны появиться записи о запросах к API

## Сброс ключей

Если ключ был скомпрометирован (попал в публичный доступ):

1. В Dashboard → Developers → API keys
2. Найдите нужный ключ
3. Нажмите на иконку **"..."** (три точки) рядом с ключом
4. Выберите **"Roll key"** или **"Сбросить ключ"**
5. Старый ключ будет недействителен, новый будет создан автоматически
6. Обновите ключ в `config.php`

## Полезные ссылки

- Dashboard Stripe: https://dashboard.stripe.com
- API Keys: https://dashboard.stripe.com/test/apikeys
- Webhooks: https://dashboard.stripe.com/test/webhooks
- Документация Stripe: https://stripe.com/docs
- Тестовые карты: https://stripe.com/docs/testing

---

## Краткая памятка

1. ✅ Войдите в Stripe Dashboard
2. ✅ Переключитесь в **Test mode**
3. ✅ Перейдите в **Developers** → **API keys**
4. ✅ Скопируйте **Publishable key** (`pk_test_...`)
5. ✅ Скопируйте **Secret key** (`sk_test_...`)
6. ✅ Создайте **Webhook endpoint** и скопируйте **Signing secret** (`whsec_...`)
7. ✅ Добавьте все ключи в `config.php`
8. ✅ Тестируйте с тестовыми картами

После успешного тестирования переключитесь на Live mode и используйте Live ключи для продакшена.

